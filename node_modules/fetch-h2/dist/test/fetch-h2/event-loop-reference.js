"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const execa = require("execa");
const server_helpers_1 = require("../lib/server-helpers");
const script = path.resolve(path.join(process.cwd(), "scripts", "test-client"));
describe("event-loop", () => {
    jest.setTimeout(20000);
    const runs = [
        { proto: "http:", version: "http1" },
        { proto: "https:", version: "http1" },
        { proto: "http:", version: "http2" },
        { proto: "https:", version: "http2" },
    ];
    runs.forEach(({ proto, version }) => {
        const { makeServer } = server_helpers_1.makeMakeServer({ proto, version });
        it(`should unref ${proto} ${version}`, async () => {
            const { port, server } = await makeServer();
            const url = `${proto}//localhost:${port}/headers`;
            const body = { foo: "bar" };
            const { stdout } = await execa(script, ["GET", url, version, "insecure"], { input: JSON.stringify(body) });
            const responseBody = JSON.parse(stdout);
            expect(responseBody["user-agent"]).toContain("fetch-h2/");
            await server.shutdown();
        });
    });
});
//# sourceMappingURL=event-loop-reference.js.map